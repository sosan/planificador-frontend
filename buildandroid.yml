- pipeline: "build android"
  on: "CLICK"
  refs:
  - "refs/heads/master"
  priority: "NORMAL"
  fail_on_prepare_env_warning: true
  actions:
  - action: "ionic capacitor build android --prod"
    type: "BUILD"
    working_directory: "/buddy/planificador-frontend"
    docker_image_name: "library/openjdk"
    docker_image_tag: "11"
    execute_commands:
    - "export ANDROID_HOME=\"/opt/android/sdk/\""
    - "export PATH=$PATH:/opt/android/sdk/cmdline-tools/tools/bin"
    - "export PATH=$PATH:/opt/gradle/gradle-4.7/bin"
    - "if [ ! -d \"$ANDROID_HOME/cmdline-tools\" ]; then"
    - " curl -o sdk.zip https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip"
    - " unzip sdk.zip"
    - " rm sdk.zip"
    - " mkdir \"$ANDROID_HOME/cmdline-tools\""
    - " mv cmdline-tools \"$ANDROID_HOME/cmdline-tools/tools\""
    - " yes | \"$ANDROID_HOME/cmdline-tools/tools/bin/sdkmanager\" --licenses"
    - "fi"
    - ""
    - "npm install"
    - "ionic capacitor build android --prod"
    setup_commands:
    - "# install gradle"
    - "apt-get update && apt-get install -y zip"
    - "curl -L -Of https://services.gradle.org/distributions/gradle-4.7-bin.zip"
    - "mkdir /opt/gradle"
    - "unzip -d /opt/gradle gradle-4.7-bin.zip"
    - "# install nodejs"
    - "curl -sL https://deb.nodesource.com/setup_14.x | bash -"
    - "apt-get install -y nodejs"
    - "npm install -g ionic"
    - "npm install i -g capacitor"
    cached_dirs:
    - "/root/.gradle"
    - "/opt/android/sdk"
    volume_mappings:
    - "/:/buddy/planificador-frontend"
    cache_base_image: true
    shell: "BASH"
